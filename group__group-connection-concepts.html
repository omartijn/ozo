<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OZO 「お象」: Concepts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OZO 「お象」
   </div>
   <div id="projectbrief">Boost.Asio and libpq based asynchronous PostgreSQL unofficial header-only C++17 client library.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__group-connection-concepts.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Concepts<div class="ingroups"><a class="el" href="group__group-connection.html">Database connection</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Description</h2>
<p>Database connection concept definition. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga9b549bf74e3c13c97f24493211722d9d"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ga9b549bf74e3c13c97f24493211722d9d"><td class="memTemplItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d">ozo::Connection</a></td></tr>
<tr class="memdesc:ga9b549bf74e3c13c97f24493211722d9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Database connection concept.  <a href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d">More...</a><br /></td></tr>
<tr class="separator:ga9b549bf74e3c13c97f24493211722d9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb64411053912bede2d7d7ad7c8057b3"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:gaeb64411053912bede2d7d7ad7c8057b3"><td class="memTemplItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-connection-concepts.html#gaeb64411053912bede2d7d7ad7c8057b3">ozo::ConnectionSource</a></td></tr>
<tr class="memdesc:gaeb64411053912bede2d7d7ad7c8057b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">ConnectionSource concept.  <a href="group__group-connection-concepts.html#gaeb64411053912bede2d7d7ad7c8057b3">More...</a><br /></td></tr>
<tr class="separator:gaeb64411053912bede2d7d7ad7c8057b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga81740a704092279e94bf9007ae3f722b"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ga81740a704092279e94bf9007ae3f722b"><td class="memTemplItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__group-connection-concepts.html#ga81740a704092279e94bf9007ae3f722b">ozo::ConnectionProvider</a></td></tr>
<tr class="memdesc:ga81740a704092279e94bf9007ae3f722b"><td class="mdescLeft">&#160;</td><td class="mdescRight">ConnectionProvider concept.  <a href="group__group-connection-concepts.html#ga81740a704092279e94bf9007ae3f722b">More...</a><br /></td></tr>
<tr class="separator:ga81740a704092279e94bf9007ae3f722b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ga9b549bf74e3c13c97f24493211722d9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9b549bf74e3c13c97f24493211722d9d">&#9670;&nbsp;</a></span>Connection</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto ozo::Connection</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Database connection concept. </p>
<p>We define the <code>Connection</code> to database not as a concrete class or type, but as an entity which must support some traits. The reason why we choose such strategy is - we want to provide flexibility and extension ability for implementation and testing. User can implement a connection bound additional functionality.</p>
<h3>Connection Definition</h3>
<p>Connection <code>conn</code> is an object for which these next statements are valid:</p>
<div class="fragment"><div class="line">decltype(<span class="keyword">auto</span>) oid_map = <a class="code" href="group__group-connection-functions.html#ga9797a8b886e75fd2631799c2e00a5942">get_connection_oid_map</a>(<a class="code" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c">unwrap_connection</a>(conn));</div></div><!-- fragment --><p> There the <code>oid_map</code> must be a reference or proxy for connection's <a class="el" href="group__group-type__system-concepts.html#ga41fff92f9d5a046bcd0654312352e153" title="Map of C++ types to corresponding PostgreSQL types OIDs.">OidMap</a> object, which allows to read and modify it. Object must be created via <code><a class="el" href="group__group-type__system-functions.html#gac97d30cda822b83aa3d54f60c658f8f7" title="Provides OidMap implementation for user-defined types.">ozo::register_types()</a></code> template function or be empty_oid_map in case if no custom types are used with the connection.</p>
<div class="fragment"><div class="line">decltype(<span class="keyword">auto</span>) socket = <a class="code" href="group__group-connection-functions.html#ga8aeeeb5f6ca8d232dd81d710e35eb2f5">get_connection_socket</a>(<a class="code" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c">unwrap_connection</a>(conn));</div></div><!-- fragment --><p> Must return reference or proxy for a socket IO stream object which allows to bind the connection to the asio io_context, currently <a href="https://www.boost.org/doc/libs/1_66_0/doc/html/boost_asio/reference/posix__stream_descriptor.html">boost::asio::posix::stream_descriptor</a> is suppurted only.</p>
<div class="fragment"><div class="line">decltype(<span class="keyword">auto</span>) handle = <a class="code" href="group__group-connection-functions.html#ga2dbee39a9e01cd1922f9cd785a7ddda5">get_connection_handle</a>(<a class="code" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c">unwrap_connection</a>(conn));</div></div><!-- fragment --><p> Must return reference or proxy for native_conn_handle object</p>
<div class="fragment"><div class="line">decltype(<span class="keyword">auto</span>) timer = <a class="code" href="group__group-connection-functions.html#ga2343a2a833bef783666b903b3ab2ea7f">get_connection_timer</a>(<a class="code" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c">unwrap_connection</a>(conn));</div></div><!-- fragment --><p> Must return reference or proxy for timer to plan operations cancel by timeout. Should provide <a href="https://www.boost.org/doc/libs/1_66_0/doc/html/boost_asio/reference/basic_waitable_timer.html">boost::asio::basic_waitable_timer</a> like interface.</p>
<div class="fragment"><div class="line">decltype(<span class="keyword">auto</span>) error_ctx = <a class="code" href="group__group-connection-functions.html#gaf0ae919262301038c9e98fbd1edaaa3d">get_connection_error_context</a>(<a class="code" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c">unwrap_connection</a>(conn));</div></div><!-- fragment --><p> Must return reference or proxy for an additional error context. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__group-connection-functions.html#ga4a8600f209dafca4db1f040bed66de6c" title="Unwrap connection if wrapped with Nullable.">ozo::unwrap_connection()</a>, <a class="el" href="group__group-connection-functions.html#ga9797a8b886e75fd2631799c2e00a5942" title="Get the connection oid map object.">ozo::get_connection_oid_map()</a>, <a class="el" href="group__group-connection-functions.html#ga8aeeeb5f6ca8d232dd81d710e35eb2f5" title="Get the connection socket object.">ozo::get_connection_socket()</a>, <a class="el" href="group__group-connection-functions.html#ga2dbee39a9e01cd1922f9cd785a7ddda5" title="Get the connection handle object.">ozo::get_connection_handle()</a>, <a class="el" href="group__group-connection-functions.html#ga2343a2a833bef783666b903b3ab2ea7f" title="Get the connection timer object.">ozo::get_connection_timer()</a>, <a class="el" href="group__group-connection-functions.html#gaf0ae919262301038c9e98fbd1edaaa3d" title="Get the connection error context object.">ozo::get_connection_error_context()</a> </dd></dl>

</div>
</div>
<a id="ga81740a704092279e94bf9007ae3f722b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga81740a704092279e94bf9007ae3f722b">&#9670;&nbsp;</a></span>ConnectionProvider</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto ozo::ConnectionProvider</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ConnectionProvider concept. </p>
<p><code>ConnectionProvider</code> is an entity which provides ready-to-use <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> by means of <code><a class="el" href="group__group-connection-functions.html#gab47cb829921abe2e3a7097362874e415" title="Get a Connection from ConnectionProvider.">ozo::get_connection()</a></code> function call.</p>
<p><code>ConnectionProvider</code> may provide <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> via the <a class="el" href="group__group-connection-concepts.html#gaeb64411053912bede2d7d7ad7c8057b3" title="ConnectionSource concept.">ConnectionSource</a> (see <code><a class="el" href="classozo_1_1connection__provider.html" title="Default implementation of ConnectionProvider.">ozo::connection_provider</a></code> as an example of such entity). In case of <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> has been provided successful <code>ConnectionProvider</code> should dispatch <a class="el" href="group__group-core-concepts.html#gaaf7889950bd13896cf94a61580635e8c" title="Handler concept.">Handler</a> with empty error_code as the first argument and the <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> as the second one. In case of failure &mdash; <code><a class="el" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731" title="Error code representation of the library.">ozo::error_code</a></code> with appropriate value and allocated <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> with additional error context, but only if it possible. Overwise <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> should be in null state</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> is a <code>ConnectionProvider</code> itself.</dd></dl>
<h3>Customization point</h3>
<p>Typically it is enough to customize <a class="el" href="group__group-connection-concepts.html#gaeb64411053912bede2d7d7ad7c8057b3" title="ConnectionSource concept.">ConnectionSource</a>, but sometimes it is more convenient to make a custom <a class="el" href="group__group-connection-concepts.html#ga81740a704092279e94bf9007ae3f722b" title="ConnectionProvider concept.">ConnectionProvider</a>, e.g. a user has a structure is binded to certain <code>ozo::io_context</code>. So in this case these steps should be done.</p>
<ul>
<li><code>ConnectionProvider</code> should deliver an information about connection type it provides. It may be implemented via defining a <code>connection_type</code> nested type or specializing <code><a class="el" href="structozo_1_1get__connection__type.html" title="Connection type getter.">ozo::get_connection_type</a></code> template. See <code><a class="el" href="structozo_1_1get__connection__type.html" title="Connection type getter.">ozo::get_connection_type</a></code> for details.</li>
<li><code><a class="el" href="group__group-connection-functions.html#gab47cb829921abe2e3a7097362874e415" title="Get a Connection from ConnectionProvider.">ozo::get_connection()</a></code> needs to be supported. See <code><a class="el" href="group__group-connection-functions.html#gab47cb829921abe2e3a7097362874e415" title="Get a Connection from ConnectionProvider.">ozo::get_connection()</a></code> for details.</li>
</ul>
<p>See <code><a class="el" href="classozo_1_1connection__provider.html" title="Default implementation of ConnectionProvider.">ozo::connection_provider</a></code> class - the default implementation and <code><a class="el" href="group__group-connection-functions.html#gab47cb829921abe2e3a7097362874e415" title="Get a Connection from ConnectionProvider.">ozo::get_connection()</a></code> description for more details. </p><dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>- type to examine. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gaeb64411053912bede2d7d7ad7c8057b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeb64411053912bede2d7d7ad7c8057b3">&#9670;&nbsp;</a></span>ConnectionSource</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto ozo::ConnectionSource</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ConnectionSource concept. </p>
<p>Before all we need to connect to our database server. First of all we need to know how to connect. Since we are smart enough, we know at least two possible ways - make a connection or get a connection from a pool of ones. How to be? It depends on. But we still need to know how to do it. So, the <code>ConnectionSource</code> is what we need! This entity tell us how to do it. ConnectionSource is a concept of type which can construct and establish connection to a database.</p>
<p>ConnectionSource has provide information about <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> type it constructs. This can be done via <code><a class="el" href="group__group-connection-types.html#gabcdb5813817ad23b230ac6d9a924cf42" title="Gives exact type of a connection object which ConnectionProvider or ConnectionSource provide.">ozo::connection_type</a></code> and it's customization.</p>
<p><code>ConnectionSource</code> should be a callable object with such signature: </p><div class="fragment"><div class="line">void (io_context&amp; io, TimeConstarint t, <a class="code" href="group__group-core-concepts.html#gaaf7889950bd13896cf94a61580635e8c">Handler</a>&amp;&amp; h);</div></div><!-- fragment --><p><code>ConnectionSource</code> must establish <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> by means of <code>io_context</code> specified as first argument. In case of connection has been established successful must dispatch Handler with empty <code>error_code</code> as the first argument and established <a class="el" href="group__group-connection-concepts.html#ga9b549bf74e3c13c97f24493211722d9d" title="Database connection concept.">Connection</a> as the second one. In case of failure &mdash; error_code with appropriate value and allocated Connection with additional error context if it possible.</p>
<p>Basic usage may looks like this: </p><div class="fragment"><div class="line">io_context io;</div><div class="line"><span class="comment">//...</span></div><div class="line"><a class="code" href="group__group-connection-concepts.html#gaeb64411053912bede2d7d7ad7c8057b3">ConnectionSource</a> source;</div><div class="line"><span class="comment">//...</span></div><div class="line"><span class="keyword">using</span> std::chrono_literals;</div><div class="line">source(io, 1s, [](<a class="code" href="group__group-errors.html#ga8757df037905ea8c9b69073e350dd731">error_code</a> ec, connection_type&lt;ConnectionSource&gt; conn){</div><div class="line"><span class="comment">//...</span></div><div class="line">});</div></div><!-- fragment --><p><code>ConnectionSource</code> is a part of <a class="el" href="group__group-connection-concepts.html#ga81740a704092279e94bf9007ae3f722b" title="ConnectionProvider concept.">ConnectionProvider</a> mechanism and typically it is no needs to use it directly.</p>
<h3>Built-in Connection Sources</h3>
<p><code><a class="el" href="classozo_1_1connection__info.html" title="Connection information.">ozo::connection_info</a></code>, <code><a class="el" href="classozo_1_1connection__pool.html" title="Connection pool implementation.">ozo::connection_pool</a></code>.</p>
<h3>Customization point</h3>
<p>This concept is a customization point for adding or modifying existing connection sources to specify custom behaviour of connection establishing. Have fun and find the best solution you want.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>&mdash; <code>ConnectionSource</code> to examine </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
